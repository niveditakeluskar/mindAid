import{_ as W,l as c,m as Y,r as T,o as u,e as _,f as C,b as e,q as Z,i as f,s as k,F as N,j as A,M as ee,t as h,h as v,d as M,v as te,R as V}from"./appInertia-949a05bd.js";import oe from"./AgGridTable-e4c69b38.js";import ae from"./FollowupModal-67034a6e.js";import"./AgGridTable.vue_vue_type_style_index_0_lang-f3773bde.js";const le={props:{patientId:Number,moduleId:Number,componentId:Number},components:{FollowupModal:ae,AgGridTable:oe},data(){},setup(r){let d=c(null),i=c();const a=c(),g=c(!1),F=c(),w=c({});let y=c();const I=c(),s=c(!1),m=c(0),n=c([{task_name:"",selectedFollowupMasterTask:"",status_flag:"",notes:"",task_date:""}]),R=c([{headerName:"Sr. No.",valueGetter:"node.rowIndex + 1"},{headerName:"Task",field:"task_notes",filter:!0},{headerName:"Category",field:"task"},{headerName:"Notes",field:"notes",cellRenderer:function(t){const l=t.data,o=document.createElement("a"),S=document.createElement("i");return S.classList.add("editform","i-Pen-4"),l&&l.notes&&o.appendChild(document.createTextNode(l.notes)),o.appendChild(S),o.classList.add("editfollowupnotes"),o.href="javascript:void(0)",o.setAttribute("data-id",l.id),o.setAttribute("data-original-title","Edit"),o.addEventListener("click",()=>{P(l.id)}),o}},{headerName:"Date Scheduled",field:"tt"},{headerName:"Task Time",field:"task_time"},{headerName:"Mark as Complete",field:"action",cellRenderer:t=>{const l=t.data;if(l&&l.action){const o=document.createElement("input");return o.setAttribute("type","checkbox"),o.classList.add("change_status_flag"),o.dataset.id=l.id,o.dataset.moduleId=l.module_id,o.dataset.componentId=l.component_id,o.dataset.stageId=l.stage_id,o.dataset.stepId=l.step_id,o.value=l.status_flag===1?1:0,o.checked=l.status_flag===1,i.value==1&&o.setAttribute("disabled",!0),o.addEventListener("click",D),o}else return""}},{headerName:"Task Completed Date",field:"task_completed_at"},{headerName:"Created By",field:"created_by",cellRenderer:function(t){const l=t.data;return l&&l.f_name?l.f_name+" "+l.l_name:"N/A"}}]),L=(t,l)=>{t.status_flag==="0"&&(t.task_date="")},x=(t,l)=>{t.status_flag==="1"?t.task_date=new Date().toISOString().substr(0,10):t.status_flag==="0"&&(t.task_date="")},q=()=>{const t={task_name:"",selectedFollowupMasterTask:"",status_flag:"",notes:"",task_date:""};n.value.push(t)},B=t=>{n.value.splice(t,1)},U=async()=>{await M.get("/org/get_future_followup_task").then(t=>{F.value=t.data}).catch(t=>{console.error("Error fetching data:",t)})},P=t=>{a.value.openModal(t,r.patientId)},j=()=>{b()},b=async()=>{try{s.value=!0;const t=await fetch(`/ccm/patient-followup-task/${r.patientId}/${r.moduleId}/followuplist`);if(!t.ok)throw new Error("Failed to fetch followup task list");s.value=!1;const l=await t.json();I.value=l.data}catch(t){console.error("Error fetching followup task list:",t),s.value=!1}},E=async()=>{try{const t="Follow_Up";let l=await fetch(`/get_stage_id/${r.moduleId}/${r.componentId}/Follow_Up`);if(!l.ok)throw new Error(`HTTP error! Status: ${l.status}`);let o=await l.json();if(!o||typeof o!="object")throw new Error("Invalid response data format");y.value=o.stageID}catch(t){throw console.error("Error fetching stageID:",t),new Error("Failed to fetch stageID")}},G=c(null),H=async()=>{g.value=!0;let t=document.getElementById("followup_form"),l=new FormData(t);M.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').content;try{const o=await M.post("/ccm/monthly-monitoring-followup-inertia",l);o&&o.status==200&&(t.reset(),n.value.splice(1),n.value[0]={task_name:"",selectedFollowupMasterTask:"",status_flag:"",notes:"",task_date:""},m.value=0,b(),$("#followUpPageAlert").html('<div class="alert alert-success"> Data Saved Successfully </div>'),updateTimer(r.patientId,"1",r.moduleId),$(".form_start_time").val(o.data.form_start_time),d.value=o.data.form_start_time,setTimeout(function(){$("#followUpPageAlert").html("")},3e3))}catch(o){g.value=!1,o.response&&o.response.status===422?(w.value=o.response.data.errors,setTimeout(function(){w.value={}},3e3),console.log(o.response.data.errors)):(console.error("Error submitting form:",o),setTimeout(function(){$("#followUpPageAlert").html("")},3e3))}g.value=!1},D=()=>{const t=document.querySelector(".change_status_flag").getAttribute("data-id"),l=document.querySelector("form[name='followup_form'] input[name='component_id']").value,o=document.querySelector("form[name='followup_form'] input[name='module_id']").value,S=document.querySelector("form[name='followup_form'] input[name='stage_id']").value,K=document.querySelector("form[name='followup_form'] input[name='step_id']").value,X=document.querySelector("form[name='followup_form'] input[name='start_time']").value,z=document.getElementById("time-container").textContent,J=document.querySelector("form[name='followup_form'] .form_start_time").value,Q=document.getElementById("form_name").value;if(confirm("Are you sure you want to change the Status"))fetch("/ccm/completeIncompleteTask",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:new URLSearchParams({id:t,timer_start:X,timer_paused:z,module_id:o,component_id:l,stage_id:S,step_id:K,form_name:Q,startTime:J})}).then(p=>{if(!p.ok)throw new Error(`HTTP error! Status: ${p.status}`);return p.json()}).then(p=>{document.getElementById("followUpPageAlert").innerHTML='<div class="alert alert-success"> Data Saved Successfully </div>',setTimeout(()=>{document.getElementById("followUpPageAlert").innerHTML=""},3e3),document.querySelector("form[name='followup_form'] .form_start_time").value=p.form_start_time,updateTimer(r.patientId,"1",r.moduleId),d.value=p.form_start_time}).catch(p=>{console.error("Error:",p)});else return!1},O=t=>{m.value=t.target.checked?1:0};return Y(async()=>{try{U(),b(),E(),d.value=document.getElementById("page_landing_times").value,i.value=document.getElementById("timer_runing_status").value}catch(t){console.error("Error on page load:",t)}}),{FollowupMainFunction:j,changeStatus:D,items:n,handleScheduledSelected:L,setCurrentDateIfCompleted:x,addNewItem:q,removeItem:B,FollowupModalRef:a,time:d,isLoading:g,followupStageId:y,loading:s,columnDefs:R,rowData:I,formErrors:w,fetchFollowupMasterTask:U,fetchFollowupMasterTaskList:b,getStageID:E,submitFollowupForm:H,followupFormRef:G,followupMasterTaskList:F,getStageID:E,handleCheckboxChange:O,timerStatus:i}}},se={class:"row"},ne={class:"col-lg-12 mb-3"},de={class:"card"},re={class:"card-body"},ce=e("div",{id:"followUpPageAlert"},null,-1),ie=["value"],me=["value"],ue=e("input",{type:"hidden",name:"start_time",value:"00:00:00"},null,-1),_e=e("input",{type:"hidden",name:"end_time",value:"00:00:00"},null,-1),fe=["value"],pe=["value"],he=["value"],ve=["value"],ge=e("input",{type:"hidden",name:"form_name",id:"form_name",value:"followup_form"},null,-1),we=e("div",{id:"error-msg"},null,-1),ke=e("div",{class:"card-title"},"Follow-up",-1),ye={class:"col-md-12"},Ie={class:"row ml-1"},be={class:"col-md-4 form-group"},Se=["onUpdate:modelValue"],Fe={class:"col-md-4 form-group selects"},Ee=["onUpdate:modelValue"],Te=e("option",{value:""},"Select Task Category",-1),Ce=["value"],Ne={key:0,class:"invalid-feedback",style:{display:"block"}},Me={class:"col-md-4 form-group"},Ue={class:"radio radio-primary col-md-4 float-left"},De=["name","onUpdate:modelValue","onChange"],Ae=e("span",null,"To be Scheduled",-1),Ve=e("span",{class:"checkmark"},null,-1),Re={class:"radio radio-primary col-md-4 float-left"},Le=["name","onUpdate:modelValue","onChange"],xe=e("span",null,"Completed",-1),qe=e("span",{class:"checkmark"},null,-1),Be={key:0,class:"invalid-feedback",style:{display:"block"}},Pe={class:"row ml-1"},je={class:"col-md-6 form-group"},Ge=["onUpdate:modelValue"],He={key:0,class:"invalid-feedback",style:{display:"block"}},Oe={class:"col-md-2 form-group"},Ke=["onUpdate:modelValue"],Xe={key:0,class:"invalid-feedback",style:{display:"block"}},ze={key:0},Je=["onClick"],Qe=e("i",{class:"remove-icons i-Remove float-right mb-3",title:"Remove Follow-up Task"},null,-1),We=[Qe],Ye=e("hr",null,null,-1),Ze={class:"col-md-1 form-group"},$e=e("i",{class:"plus-icons i-Add",id:"add_followup_task",title:"Add Follow-up Task"},null,-1),et=[$e],tt={class:"mb-4"},ot={class:"form-row"},at={class:"form-group col-md-12"},lt={class:"forms-element checkbox checkbox-outline-primary"},st=e("span",null,"EMR system entry completed",-1),nt=e("span",{class:"checkmark"},null,-1),dt={key:0,id:"followup_emr_system_entry_complete_error",class:"invalid-feedback",style:{display:"block"}},rt={class:"row"},ct={class:"col-lg-12 text-right"},it=["disabled"],mt=e("hr",null,null,-1),ut={class:"col-md-12"},_t=e("div",{class:"card-footer"},[e("div",{class:"mc-footer"})],-1);function ft(r,d,i,a,g,F){const w=T("loading-spinner"),y=T("FollowupModal"),I=T("AgGridTable");return u(),_(N,null,[C(w,{isLoading:a.isLoading},null,8,["isLoading"]),e("div",se,[e("div",ne,[e("div",de,[e("div",re,[ce,e("form",{id:"followup_form",ref:"followupFormRef",name:"followup_form",onSubmit:d[5]||(d[5]=Z((...s)=>a.submitFollowupForm&&a.submitFollowupForm(...s),["prevent"]))},[e("input",{type:"hidden",name:"uid",value:`${i.patientId}`},null,8,ie),e("input",{type:"hidden",name:"patient_id",value:`${i.patientId}`},null,8,me),ue,_e,e("input",{type:"hidden",name:"module_id",value:`${i.moduleId}`},null,8,fe),e("input",{type:"hidden",name:"component_id",value:`${i.componentId}`},null,8,pe),f(e("input",{type:"hidden",name:"stage_id","onUpdate:modelValue":d[0]||(d[0]=s=>a.followupStageId=s),value:a.followupStageId},null,8,he),[[k,a.followupStageId]]),e("input",{type:"hidden",name:"timearr[form_start_time]",class:"timearr form_start_time",value:a.time},null,8,ve),f(e("input",{type:"hidden",name:"step_id","onUpdate:modelValue":d[1]||(d[1]=s=>r.step_id=s),value:"0"},null,512),[[k,r.step_id]]),ge,we,ke,e("div",null,[(u(!0),_(N,null,A(a.items,(s,m)=>(u(),_("div",{key:m},[e("div",ye,[e("div",Ie,[e("div",be,[f(e("input",{type:"text",name:"task_name[]",class:"forms-element form-control",placeholder:"Task","onUpdate:modelValue":n=>s.task_name=n},null,8,Se),[[k,s.task_name]])]),e("div",Fe,[f(e("select",{name:"followupmaster_task[]",id:"followupmaster_task",class:"custom-select show-tick select2","onUpdate:modelValue":n=>s.selectedFollowupMasterTask=n},[Te,(u(!0),_(N,null,A(a.followupMasterTaskList,n=>(u(),_("option",{key:n.id,value:n.id},h(n.task),9,Ce))),128))],8,Ee),[[te,s.selectedFollowupMasterTask]]),a.formErrors.followupmaster_task?(u(),_("div",Ne,h(a.formErrors.followupmaster_task[0]),1)):v("",!0)]),e("div",Me,[e("label",Ue,[f(e("input",{type:"radio",class:"status_flag",name:"status_flag["+m+"]",value:"0",formControlName:"radio",checked:"","onUpdate:modelValue":n=>s.status_flag=n,onChange:n=>a.handleScheduledSelected(s,m)},null,40,De),[[V,s.status_flag]]),Ae,Ve]),e("label",Re,[f(e("input",{type:"radio",class:"status_flag",name:"status_flag["+m+"]",value:"1",formControlName:"radio","onUpdate:modelValue":n=>s.status_flag=n,onChange:n=>a.setCurrentDateIfCompleted(s,m)},null,40,Le),[[V,s.status_flag]]),xe,qe]),a.formErrors.status_flag?(u(),_("div",Be,h(a.formErrors.status_flag[m]),1)):v("",!0)])]),e("div",Pe,[e("div",je,[f(e("textarea",{name:"notes[]",class:"forms-element form-control",placeholder:"Notes","onUpdate:modelValue":n=>s.notes=n},null,8,Ge),[[k,s.notes]]),a.formErrors.notes?(u(),_("div",He,h(a.formErrors.notes[0]),1)):v("",!0)]),e("div",Oe,[f(e("input",{type:"date",name:"task_date[]",class:"forms-element form-control","onUpdate:modelValue":n=>s.task_date=n},null,8,Ke),[[k,s.task_date]]),a.formErrors.task_date?(u(),_("div",Xe,h(a.formErrors.task_date[0]),1)):v("",!0)])])]),m>0?(u(),_("div",ze,[e("div",{onClick:n=>a.removeItem(m)},We,8,Je)])):v("",!0),Ye]))),128)),e("div",Ze,[e("div",{onClick:d[2]||(d[2]=(...s)=>a.addNewItem&&a.addNewItem(...s))},et)])]),e("div",tt,[e("div",ot,[e("div",at,[e("label",lt,[f(e("input",{type:"checkbox",name:"emr_complete",id:"emr_complete","onUpdate:modelValue":d[3]||(d[3]=s=>r.emr_complete=s),"true-value":"1","false-value":"0",onClick:d[4]||(d[4]=(...s)=>a.handleCheckboxChange&&a.handleCheckboxChange(...s))},null,512),[[ee,r.emr_complete]]),st,nt]),a.formErrors.emr_complete?(u(),_("div",dt,h(a.formErrors.emr_complete[0]),1)):v("",!0)])]),e("div",rt,[e("div",ct,[e("button",{type:"submit",class:"btn btn-primary m-1 office-visit-save",disabled:a.timerStatus==1},"Save",8,it)])])])],544)]),C(y,{ref:"FollowupModalRef",moduleId:i.moduleId,componentId:i.componentId,stageId:a.followupStageId,patientId:i.patientId,followupCallFunction:a.FollowupMainFunction},null,8,["moduleId","componentId","stageId","patientId","followupCallFunction"]),mt,e("div",ut,[C(I,{rowData:a.rowData,columnDefs:a.columnDefs},null,8,["rowData","columnDefs"])]),_t])])])],64)}const kt=W(le,[["render",ft]]);export{kt as default};
