import{_ as P,l as n,m as U,r as j,o as v,e as p,b as e,n as T,f as K,q as z,i as g,s as L,h as b,v as O,t as D,F,j as H,d as w,p as X,a as G}from"./appInertia-949a05bd.js";import"./AgGridTable.vue_vue_type_style_index_0_lang-f3773bde.js";import J from"./LayoutComponent-df3a46ea.js";import"./Header-2dd02e50.js";import"./Footer-27143538.js";const Q={props:{patientId:Number,moduleId:Number,componentId:Number},data(){return{isOpen:!1,adddevicetime:null}},components:{LayoutComponent:J},methods:{openModal(){this.isOpen=!0,this.adddevicetime=document.getElementById("page_landing_times").value},closeModal(){this.isOpen=!1}},setup(c){const o=n(""),u=n(null),a=n(!0),f=n(""),r=n({}),h=n(!1),t=n(!1),k=n(""),m=n(null),E=n(""),I=n(""),S=n("");n(""),n(!1);const A=n(!1);let x=n([]);n([]),n(""),n(""),n("");const B=async()=>{t.value=!0;let l=document.getElementById("patient_add_device_form"),i=new FormData(l);w.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').content;try{const s=await w.post("/ccm/additional-device-email",i);s&&s.status==200&&(h.value=!0,alert("Saved Successfully"),updateTimer(c.patientId,"1",c.moduleId),$(".form_start_time").val(s.data.form_start_time),document.getElementById("patient_add_device_form").reset(),setTimeout(()=>{h.value=!1,u.value=document.getElementById("page_landing_times").value},3e3)),t.value=!1}catch(s){s.response&&s.response.status===422?(console.log(s.response),r.value=s.response.data.errors):(alert("oopz! something went wrong. Try again or Contact Administrator"),console.error("Error submitting form:",s)),t.value=!1}};let R=async()=>{try{await new Promise(_=>setTimeout(_,2e3));const l=await fetch("/patients/getcontent-template");if(!l.ok)throw new Error("Failed to fetch email list");const i=await l.json(),s=Object.entries(i).map(([_,y])=>({id:_,content_title:y}));x.value=s,E.value=s[s.length-1].id,C(E.value)}catch(l){console.error("Error fetching email list:",l)}},C=async l=>{await w.get(`/ccm/get-call-scripts-by-id/${l}/${c.patientId}/call-script`).then(i=>{I.value=i.data.finaldata;const s=`${m.value.getData()}${I.value}`;m.value.setData(s)}).catch(i=>{console.error("Error fetching data:",i)})};const N=async()=>{try{t.value=!0,k.value=document.querySelector('meta[name="csrf-token"]').content;const l=await fetch("/patients/getdevicevl",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({patientid:c.patientId,add_replace_device:f.value,_token:k.value})});if(t.value=!1,l.ok){const i=await l.json(),s=document.querySelector(".wrapMulDropDevices ul");s?(s.innerHTML="",i.forEach(_=>{const y=document.createElement("li");y.innerHTML=`
                <label class="forms-element checkbox checkbox-outline-primary">
                  <input class="ckbox"
                         name="device_ids[${_.id}]"
                         id="${_.device_name}"
                         value="${_.id}"
                         type="checkbox">
                  <span>${_.device_name}</span><span class="checkmark"></span>
                </label>
              `,y.querySelector("input").addEventListener("click",V=>M(V.target)),s.appendChild(y)})):console.error("Target ul element not found")}else console.error("Failed to fetch device data")}catch(l){console.error("Error:",l)}},M=l=>{if(m.value&&l.checked){const i=l.id,s=`${m.value.getData()}<li>${i}</li>`;m.value.setData(s)}else if(m.value){const i=m.value.getData().replace(`<li>${l.id}</li>`,"").trim();m.value.setData(i)}S.value=`${m.value.getData()}`};let q=async()=>{try{let l="Email",i=await w.get(`/get_stage_id/${c.moduleId}/${c.componentId}/${l}`);o.value=i.data.stageID}catch{throw new Error("Failed to fetch Patient Data stageID")}};return U(async()=>{R(),q();try{u.value=document.getElementById("page_landing_times").value}catch(l){console.error("Error on page load:",l)}await new Promise(l=>{CKEDITOR.on("instanceReady",function(i){i.editor.name==="email_title_area"&&(m.value=i.editor,l())}),CKEDITOR.replace("email_title_area")})}),{emailStageId:o,isSaveButtonDisabled:a,loading:A,emailOptions:x,formErrors:r,isLoading:t,showSuccessAlert:h,addReplaceDevice:f,handleDeviceChange:N,selectedEmail:E,adddevicetime:u,token:k,editorData:m,mail_content:S,getDevice:M,submitadddeviceForm:B,textScript:C,textScripts:I}}},d=c=>(X("data-v-e22671ef"),c=c(),G(),c),W={class:"modal-content"},Y={class:"modal-header"},Z=d(()=>e("h4",{class:"modal-title"},"Add Devices",-1)),ee={class:"modal-body"},te=["value"],ae=["value"],oe=d(()=>e("input",{type:"hidden",name:"start_time",value:"00:00:00"},null,-1)),le=d(()=>e("input",{type:"hidden",name:"end_time",value:"00:00:00"},null,-1)),se=["value"],ne=["value"],ie=d(()=>e("input",{type:"hidden",name:"id"},null,-1)),de=["value"],ce=["value"],re={key:0,class:"alert alert-success",id:"device-alert"},me=d(()=>e("button",{type:"button",class:"close","data-dismiss":"alert"},"x",-1)),ue=d(()=>e("strong",null,"Additional Device data saved successfully! ",-1)),_e=d(()=>e("span",{id:"text"},null,-1)),ve=[me,ue,_e],pe={class:"row"},fe={class:"col-md-12 form-group mb-3"},he=d(()=>e("option",{value:"1"},"Additional device",-1)),ye=d(()=>e("option",{value:"2"},"Replace device",-1)),ge=[he,ye],be={key:0,class:"invalid-feedback",style:{display:"block"}},De={class:"col-md-6 form-group mb-3"},we=d(()=>e("label",{for:"sel1"},"Select Device:",-1)),ke={class:"wrapMulDropDevices"},Ee={ref:"deviceList",style:{"list-style-type":"none"}},Ie={class:"col-md-6 form-group mb-3"},Se=d(()=>e("label",{for:"sel1"},"Email Template:",-1)),xe=d(()=>e("option",{value:"0"},"Select Template",-1)),Ce=["value"],Me={key:0,class:"invalid-feedback",style:{display:"block"}},Te=d(()=>e("div",{class:"col-md-6 form-group mb-3",style:{display:"none"}},[e("input",{type:"text",class:"form-control",name:"email_from",id:"email_from"})],-1)),Le=d(()=>e("div",{class:"col-md-6 form-group mb-3",style:{display:"none"}},[e("input",{type:"text",class:"form-control",name:"email_sub",id:"email_sub"})],-1)),Oe={class:"col-md-12 form-group mb-3"},Fe=d(()=>e("label",null,[e("b",null,"Content"),e("span",{class:"error"},"*")],-1)),Ae={key:0,class:"invalid-feedback",style:{display:"block"}},Be={class:"modal-footer"},Re=d(()=>e("button",{type:"submit",class:"btn btn-primary float-right submit-patient-add_device"},"Submit",-1)),Ne={class:"modal-footer"};function qe(c,o,u,a,f,r){const h=j("loading-spinner");return v(),p(F,null,[e("div",{class:T(["overlay",{open:f.isOpen}]),onClick:o[0]||(o[0]=(...t)=>r.closeModal&&r.closeModal(...t))},null,2),e("div",{class:T(["modal fade",{open:f.isOpen}])},[e("div",W,[e("div",Y,[Z,e("button",{type:"button",class:"close",onClick:o[1]||(o[1]=(...t)=>r.closeModal&&r.closeModal(...t))},"Ã—")]),e("div",ee,[K(h,{isLoading:a.isLoading},null,8,["isLoading"]),e("form",{method:"post",name:"patient_add_device_form",id:"patient_add_device_form",onSubmit:o[9]||(o[9]=z((...t)=>a.submitadddeviceForm&&a.submitadddeviceForm(...t),["prevent"]))},[e("input",{type:"hidden",name:"patient_id",id:"patient_id",value:u.patientId},null,8,te),e("input",{type:"hidden",name:"uid",value:u.patientId},null,8,ae),oe,le,e("input",{type:"hidden",name:"module_id",id:"module_id",value:u.moduleId},null,8,se),e("input",{type:"hidden",name:"component_id",value:u.componentId},null,8,ne),ie,e("input",{type:"hidden",name:"mail_content",id:"mail_content",value:a.mail_content},null,8,de),e("input",{type:"hidden",name:"timearr[form_start_time]",class:"timearr form_start_time",value:a.adddevicetime},null,8,ce),g(e("input",{type:"hidden",name:"stage_id","onUpdate:modelValue":o[2]||(o[2]=t=>a.emailStageId=t)},null,512),[[L,a.emailStageId]]),a.showSuccessAlert?(v(),p("div",re,ve)):b("",!0),e("div",pe,[e("div",fe,[g(e("select",{name:"add_replace_device",id:"add_replace_device",class:"custom-select show-tick select2","onUpdate:modelValue":o[3]||(o[3]=t=>a.addReplaceDevice=t),onChange:o[4]||(o[4]=(...t)=>a.handleDeviceChange&&a.handleDeviceChange(...t)),required:""},ge,544),[[O,a.addReplaceDevice]]),a.formErrors.add_replace_device?(v(),p("div",be,D(a.formErrors.add_replace_device[0]),1)):b("",!0)]),e("div",De,[we,e("div",ke,[e("ul",Ee,null,512)])]),e("div",Ie,[Se,g(e("select",{id:"email_title",class:"custom-select show-tick",name:"call_not_answer_template_id","onUpdate:modelValue":o[5]||(o[5]=t=>a.selectedEmail=t),onChange:o[6]||(o[6]=t=>a.textScript(a.selectedEmail)),required:""},[xe,(v(!0),p(F,null,H(a.emailOptions,t=>(v(),p("option",{key:t.id,value:t.id},D(t.content_title),9,Ce))),128))],544),[[O,a.selectedEmail]]),a.formErrors.call_not_answer_template_id?(v(),p("div",Me,D(a.formErrors.call_not_answer_template_id[0]),1)):b("",!0)]),Te,Le,e("div",Oe,[Fe,g(e("textarea",{name:"text_msg",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=t=>a.editorData=t),id:"email_title_area",style:{padding:"5px",width:"47em","min-height":"5em",overflow:"auto",height:"87px"}},null,512),[[L,a.editorData]]),a.formErrors.text_msg?(v(),p("div",Ae,D(a.formErrors.text_msg[0]),1)):b("",!0)])]),e("div",Be,[Re,e("button",{type:"button",class:"btn btn-default float-left","data-dismiss":"modal",onClick:o[8]||(o[8]=(...t)=>r.closeModal&&r.closeModal(...t))},"Close")])],32)]),e("div",Ne,[e("button",{type:"button",class:"btn btn-default","data-dismiss":"modal",onClick:o[10]||(o[10]=(...t)=>r.closeModal&&r.closeModal(...t))},"Close")])])],2)],64)}const He=P(Q,[["render",qe],["__scopeId","data-v-e22671ef"]]);export{He as default};
