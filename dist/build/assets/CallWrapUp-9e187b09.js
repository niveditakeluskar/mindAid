import{_ as re,l as c,H as j,m as ne,r as ie,o as _,e as u,b as e,q as ce,I as de,i as y,v as me,h as w,f as _e,k as ue,s as T,t as b,F as W,j as V,M,d as g,n as O,V as pe}from"./appInertia-bd981cc7.js";import he from"./AgGridTable-ef5374d2.js";import{h as ve}from"./moment-fbc5633a.js";import"./AgGridTable.vue_vue_type_style_index_0_lang-56c71005.js";const ye={props:{patientId:Number,moduleId:Number,componentId:Number},components:{AgGridTable:he},setup(m){const n=c([]),p=c(!1),o=c(0);let k=c(null),U=c();const D=c([]),t=c([]);let i=c([]),l=c(!1),f=c(null);c([]);let N=c(!1);const C=c(""),E=c([]),F=c([]),L=c([]);let B=c("");const H=c([{headerName:"Seq.",valueGetter:"node.rowIndex + 1",width:20},{headerName:"Topic",field:"topic",filter:!0},{headerName:"Care Manager Notes",field:"notes",width:100,suppressSizeToFit:!0},{headerName:"Action Taken",field:"action_taken",width:60},{headerName:"Action",field:"action",width:20,cellRenderer:function(a){return a.data.action}}]),I=async()=>{try{p.value=!0,await new Promise(s=>setTimeout(s,2e3));const a=await fetch(`/ccm/monthly-monitoring-call-wrap-up/${m.patientId}`);if(!a.ok)throw new Error("Failed to fetch call wrap up list");p.value=!1;const r=await a.json();n.value=r.data}catch(a){console.error("Error fetching call wrap up list:",a),p.value=!1}},P=()=>t.value.some(r=>r.checked),K=async()=>{i.value={},l.value=!1,f.value=null;let a=document.getElementById("callwrapup_form"),r=new FormData(a);const s=[];if(!C.value){if(!P()){l.value=!0,f.value="Please choose at least one additional service";return}if(!t.value.every(h=>{if(h.checked){const S=h.items.some(x=>{const v=x.itemChecked;return v&&s.push(x.itemChecked),v});return S||(l.value=!0,f.value="Please choose at least one sub additional service"),S}return!0}))return}g.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').content;try{const d=await g.post("/ccm/monthly-monitoring-call-callwrapup",r);d&&d.status==200&&($(".form_start_time").val(d.data.form_start_time),N.value=!0,updateTimer(m.patientId,"1",m.moduleId),await I(),document.getElementById("callwrapup_form").reset(),setTimeout(()=>{N.value=!1,k.value=document.getElementById("page_landing_times").value},3e3),i.value=[],l.value=!1,t.value.forEach(R=>{R.checked=!1,R.items.forEach(h=>{h.itemChecked=!1})}),E.value=[],q(),this.$emit("form-submitted"))}catch(d){d.response.status&&d.response.status===422?i.value=d.response.data.errors:console.error("Error submitting form:",d)}},Y=async a=>{if(window.confirm("Are you sure you want to delete this notes?")){document.getElementById("page_landing_times").value;try{const r=await g.get(`/ccm/delete-callwrapup-notes/${m.patientId}`,{params:{id:a,start_time:"00:00:00",end_time:"00:00:00",form_start_time:document.getElementById("page_landing_times").value}});updateTimer(m.patientId,"1",m.moduleId),$(".form_start_time").val(r.data.trim()),await I(),setTimeout(()=>{k.value=document.getElementById("page_landing_times").value},3e3)}catch(r){console.error("Error deletting record:",r)}}};let X=async()=>{try{let a="Call_Wrap_Up";const r=await g.get(`/get_stage_id/${m.moduleId}/${m.componentId}/${a}`);o.value=r.data.stageID}catch(a){throw console.error("Error fetching stageID:",a),new Error("Failed to fetch stageID")}},q=async()=>{try{const a=await fetch(`/ccm/populate-monthly-monitoring-data/${m.patientId}`);if(!a.ok)throw new Error(`Failed to fetch Patient Call wrap-up - ${a.status} ${a.statusText}`);const s=(await a.json()).callwrapup_form;if(console.log("Patient Call wrap-up data",s),s.emr_monthly_summary!=""&&(F.value=s.emr_monthly_summary[0].notes),s.checklist_data&&s.checklist_data.emr_entry_completed!=null&&(L.value=s.checklist_data.emr_entry_completed),s.summary&&Array.isArray(s.summary)&&s.summary.forEach(d=>{E.value.push({date:ve(d.record_date,"MM-DD-YYYY").format("YYYY-MM-DD"),text:d.notes})}),s.additional_services)try{const d=s.additional_services[0].notes.trim();d=="No Additional Services Provided"?C.value=!0:(await J(),d.split(";").map(h=>h.trim()).forEach(h=>{const S=h.split(":")[0].toLowerCase().replace(/[\s/]/g,"_"),x=S.replace(/[\s/]/g,""),v=t.value.findIndex(z=>z.name.replace(/[\s/]/g,"_").toLowerCase()===S);if(v!==-1){console.log("groupIndex",v),t.value[v].checked=!0;let qt=h.split(":")[1].toLowerCase().trim().replace(/[\s/]/g,"_").split(",").map(G=>{if(G!=""){const se=x+"_"+G.trim().replace(/^_/,""),A=t.value[v].items.findIndex(le=>`${x+"_"+le.activity.replace(/[\s/]/g,"_").toLowerCase()}`===se);A!==-1&&(console.log("itemIndex",A),t.value[v].items[A].itemChecked=!0)}})}}))}catch(d){console.error("Error in additional_services processing:",d)}}catch(a){console.error("Error fetching Call wrap-up:",a)}};const J=async()=>{for(;!t.value||!t.value.length;)await new Promise(a=>setTimeout(a,100))},Q=()=>{window.deleteCallWrapup=Y},Z=async()=>{const a={};try{const r=await g.get("/ccm/monthly-monitoring-call-wrap-up-activities/activities");D.value=r.data,D.value.forEach(s=>{a[s.activity_type]||(a[s.activity_type]={name:s.activity_type,items:[]}),s.itemChecked=!1,a[s.activity_type].items.push(s)}),t.value=Object.values(a).map(s=>({...s,checked:!1}))}catch(r){console.error("Error fetching data:",r)}};j(C,a=>{pe({}),a&&(t.value.forEach(r=>{r.checked=!1,r.items.forEach(s=>{s.itemChecked=!1})}),l.value=!1,f.value=null)},{immediate:!0}),j(t,a=>{a.some(s=>s.checked)&&(C.value=!1)},{deep:!0,immediate:!0});const ee=()=>{const a=new Date().toISOString().split("T")[0];E.value.push({date:a,text:""})},te=a=>{E.value.splice(a,1)},ae=()=>{let a=B.value;if(a==2)window.open(`/reports/device-data-report/${m.patientId}`,"_blank");else if(a==3){const s=new Date().getMonth()+1;window.open(`/rpm/alert-history/${m.patientId}/${s}`,"_blank")}},oe=async()=>{i.value={};let a=document.getElementById("callwrapup_form"),r=new FormData(a);g.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').content;try{const s=await g.post("/ccm/saveEmrSummary",r);s&&s.status==200&&($(".form_start_time").val(s.data.form_start_time),updateTimer(m.patientId,"1",m.moduleId),await I(),setTimeout(()=>{N.value=!1,k.value=document.getElementById("page_landing_times").value},3e3),i.value=[],l.value=!1)}catch(s){s.response.status&&s.response.status===422?i.value=s.response.data.errors:console.error("Error submitting form:",s)}};return ne(async()=>{try{I(),Q(),X(),q(),Z(),k.value=document.getElementById("page_landing_times").value,U.value=document.getElementById("timer_runing_status").value}catch(a){console.error("Error on page load:",a)}}),{loading:p,callWrapColumnDefs:H,callWrapRowData:n,callWrapUpStageId:o,callWrapUpTime:k,fetchCallWrapUpList:I,submitCallWrapUpFormData:K,deleteCallWrapup:Y,groupedData:t,checkAdditionalServicesSelected:P,formErrors:i,additionalErrors:l,additionalErrorsMsg:f,showCallWrapUpAlert:N,noAdditionalServicesProvided:C,notesRows:E,addNewNotesRow:ee,deleteNotesRow:te,onRPMReportChanged:ae,selectedReport:B,saveEMRNotes:oe,emr_monthly_summary:F,emr_monthly_summary_completed:L,timerStatus:U}}},fe={class:"row"},we={class:"col-lg-12 mb-3"},ge={class:"card"},ke={class:"card-body"},be={class:"mb-4 ml-4"},Ce=e("button",{type:"button",class:"close","data-dismiss":"alert"},"x",-1),Ee=e("strong",null,"Call wrap-up data successfully! ",-1),Ie=e("span",{id:"text"},null,-1),Se=[Ce,Ee,Ie],xe={class:"row mb-4"},De=e("div",{class:"col-md-3"},[e("h6",null,[e("b",null,"Call Notes for Review and Approval")])],-1),Ne={key:0,class:"col-md-3"},Re=e("option",null,"Select Report",-1),Me=e("option",{value:"2"},"Daily History Report",-1),Ue=[Re,Me],Ae={class:"col-md-3"},Te=["href"],We={class:"row m-1"},Ve={class:"col-12"},Fe=["value"],Le=["value"],Be=e("input",{type:"hidden",name:"start_time",value:"00:00:00"},null,-1),Pe=e("input",{type:"hidden",name:"end_time",value:"00:00:00"},null,-1),Ye=["value"],qe=["value"],ze=["value"],Ge=["value"],je=e("input",{type:"hidden",name:"form_name",value:"callwrapup_form"},null,-1),Oe=e("input",{type:"hidden",name:"billable",value:"1"},null,-1),He=["value"],Ke={class:"row ml-3"},Xe={class:"col-md-12 form-group"},Je={class:"forms-element"},Qe={class:"col-md-12"},Ze={key:0,class:"invalid-feedback",style:{display:"block"}},$e={class:"col-md-12",style:{"margin-bottom":"40px"}},et={class:"row"},tt=e("div",{class:"col-md-3"},[e("b",null,[e("span",{style:{"margin-left":"20px",color:"#69aac2"}},"Additional CCM Notes :")])],-1),at={class:"col-md-1"},ot={class:"row",id:"additional_monthly_notes",style:{"margin-left":"0.05rem !important"}},st={class:"col-md-4"},lt=["onUpdate:modelValue","id"],rt={key:0,class:"invalid-feedback",style:{display:"block"}},nt={class:"col-md-6"},it=["onUpdate:modelValue","id"],ct={key:0,class:"invalid-feedback",style:{display:"block"}},dt={class:"col-md-1",style:{top:"15px"}},mt=["onClick"],_t={class:"col-md-12 forms-element"},ut={class:"row"},pt={class:"col-md-4"},ht={for:"emr_entry_completed",class:"checkbox checkbox-primary mr-3"},vt=["checked"],yt=e("span",null,"EMR system entry completed",-1),ft=e("span",{class:"checkmark"},null,-1),wt=e("hr",{style:{width:"100%"}},null,-1),gt={class:"col-md-12 forms-element"},kt={class:"row"},bt=e("div",{class:"col-md-12"},[e("b",null,[e("span",{style:{"margin-left":"20px",color:"#69aac2"}},"Additional Services :")])],-1),Ct=["for"],Et=["onUpdate:modelValue","name","id"],It=e("span",{class:"checkmark"},null,-1),St=["for"],xt=["onUpdate:modelValue","name","id"],Dt=e("span",{class:"checkmark"},null,-1),Nt=e("span",{class:"checkmark"},null,-1),Rt={class:"col-md-4"},Mt={for:"no_additional_services_provided",class:"checkbox checkbox-primary mr-3"},Ut=e("span",null,"No Additional Services Provided",-1),At=e("span",{class:"checkmark"},null,-1),Tt={key:0,style:{color:"red"}},Wt=e("div",{class:"form-row invalid-feedback"},null,-1),Vt={class:"card-footer"},Ft={class:"mc-footer"},Lt={class:"row"},Bt={class:"col-lg-12 text-right"},Pt=["disabled"];function Yt(m,n,p,o,k,U){const D=ie("AgGridTable");return _(),u("div",fe,[e("div",we,[e("form",{id:"callwrapup_form",name:"callwrapup_form",onSubmit:n[8]||(n[8]=ce((...t)=>o.submitCallWrapUpFormData&&o.submitCallWrapUpFormData(...t),["prevent"]))},[e("div",ge,[e("div",ke,[e("div",be,[e("div",{class:"alert alert-success",id:"callwrapform-success-alert",style:de({display:o.showCallWrapUpAlert?"block":"none"})},Se,4),e("div",xe,[De,p.moduleId===2?(_(),u("div",Ne,[y(e("select",{name:"select_report",class:"custom-select show-tick mr-4","onUpdate:modelValue":n[0]||(n[0]=t=>o.selectedReport=t),onChange:n[1]||(n[1]=t=>o.onRPMReportChanged())},Ue,544),[[me,o.selectedReport]])])):w("",!0),e("div",Ae,[e("a",{href:`/ccm/monthly-monitoring/call-wrap-up-word/${p.patientId}`,class:"btn btn-primary",target:"_blank"},"Care Manager Notes Word Format",8,Te)])])]),e("div",We,[e("div",Ve,[_e(D,{rowData:o.callWrapRowData,columnDefs:o.callWrapColumnDefs},null,8,["rowData","columnDefs"])])]),e("input",{type:"hidden",name:"uid",value:p.patientId},null,8,Fe),e("input",{type:"hidden",name:"patient_id",value:p.patientId},null,8,Le),Be,Pe,e("input",{type:"hidden",name:"module_id",value:p.moduleId},null,8,Ye),e("input",{type:"hidden",name:"component_id",value:p.componentId},null,8,qe),e("input",{type:"hidden",name:"stage_id",value:o.callWrapUpStageId},null,8,ze),e("input",{type:"hidden",name:"step_id",value:m.callWrapUpStepId},null,8,Ge),je,Oe,e("input",{type:"hidden",name:"timearr[form_start_time]",class:"timearr form_start_time",value:o.callWrapUpTime},null,8,He),e("div",Ke,[e("div",Xe,[e("div",Je,[e("label",Qe,[ue("EMR Monthly Summary "),y(e("textarea",{class:"form-control",cols:"90",name:"emr_monthly_summary[]",id:"callwrap_up_emr_monthly_summary",onBlur:n[2]||(n[2]=(...t)=>o.saveEMRNotes&&o.saveEMRNotes(...t)),"onUpdate:modelValue":n[3]||(n[3]=t=>o.emr_monthly_summary=t)},null,544),[[T,o.emr_monthly_summary]])]),o.formErrors&&o.formErrors["emr_monthly_summary.0"]?(_(),u("div",Ze,b(o.formErrors["emr_monthly_summary.0"][0]),1)):w("",!0)])]),e("div",$e,[e("div",et,[tt,e("div",at,[e("i",{onClick:n[4]||(n[4]=(...t)=>o.addNewNotesRow&&o.addNewNotesRow(...t)),id:"addnotes",type:"button",qno:"1",class:"add i-Add",style:{color:"rgb(44, 184, 234)","font-size":"25px",float:"left"}})])]),e("div",ot,[(_(!0),u(W,null,V(o.notesRows,(t,i)=>(_(),u("div",{class:"additionalfeilds row",style:{"margin-left":"0.05rem !important","margin-bottom":"0.5rem"},key:i},[e("div",st,[y(e("input",{type:"date","onUpdate:modelValue":l=>t.date=l,name:"emr_monthly_summary_date[]",class:"form-control emr_monthly_summary_date",id:`emr_monthly_summary_date_${i}`},null,8,lt),[[T,t.date]]),o.formErrors&&o.formErrors["emr_monthly_summary_date."+i]?(_(),u("div",rt,b(o.formErrors["emr_monthly_summary_date."+i][0]),1)):w("",!0)]),e("div",nt,[y(e("textarea",{"onUpdate:modelValue":l=>t.text=l,class:"form-control emrsummary",cols:"90",name:"emr_monthly_summary[]",id:`emr_monthly_summary_${i}`,onBlur:n[5]||(n[5]=(...l)=>o.saveEMRNotes&&o.saveEMRNotes(...l))},null,40,it),[[T,t.text]]),o.formErrors&&o.formErrors["emr_monthly_summary."+(i+1)]?(_(),u("div",ct,b(o.formErrors["emr_monthly_summary."+(i+1)][0]),1)):w("",!0)]),e("div",dt,[e("i",{onClick:l=>o.deleteNotesRow(i),type:"button",class:"removenotes i-Remove",style:{color:"#f44336","font-size":"22px"}},null,8,mt)])]))),128))])]),e("div",_t,[e("div",ut,[e("div",pt,[e("label",ht,[y(e("input",{type:"checkbox",name:"emr_entry_completed",id:"emr_entry_completed",value:"1",class:"RRclass emr_entry_completed","onUpdate:modelValue":n[6]||(n[6]=t=>o.emr_monthly_summary_completed=t),checked:o.emr_monthly_summary_completed,formControlName:"checkbox"},null,8,vt),[[M,o.emr_monthly_summary_completed]]),yt,ft])])])]),wt,e("div",gt,[e("div",kt,[bt,o.groupedData&&o.groupedData.length>0?(_(!0),u(W,{key:0},V(o.groupedData,(t,i)=>(_(),u("div",{key:i,class:"col-md-4"},[e("div",null,[e("label",{for:`${t.name.replace(/[\s/]/g,"_").toLowerCase()}`,class:"checkbox checkbox-primary mr-3"},[y(e("input",{type:"checkbox","onUpdate:modelValue":l=>t.checked=l,name:`${t.name.replace(/[\s/]/g,"_").toLowerCase()}`,id:`${t.name.replace(/[\s/]/g,"_").toLowerCase()}`,value:"true",class:O(["RRclass",`${t.name.replace(/[\s/]/g,"_").toLowerCase()}`]),formControlName:"checkbox"},null,10,Et),[[M,t.checked]]),e("span",null,b(t.name),1),It],8,Ct),t.checked?(_(!0),u(W,{key:0},V(t.items,l=>(_(),u("div",{class:"col-md-12",key:l.id},[e("label",{for:`${t.name.replace(/[\s/]/g,"").toLowerCase()}_${l.activity.replace(/[\s/]/g,"_").toLowerCase()}`,class:"checkbox checkbox-primary mr-3"},[y(e("input",{type:"checkbox","onUpdate:modelValue":f=>l.itemChecked=f,name:`${t.name.replace(/[\s/]/g,"").toLowerCase()}[${l.activity.replace(/[\s/]/g,"_").toLowerCase()}]`,id:`${t.name.replace(/[\s/]/g,"").toLowerCase()}_${l.activity.replace(/[\s/]/g,"_").toLowerCase()}`,value:"true",class:O(`${l.activity.replace(/[\s/]/g,"_").toLowerCase()}`),formControlName:"checkbox"},null,10,xt),[[M,l.itemChecked]]),e("span",null,b(l.activity),1),Dt],8,St),Nt]))),128)):w("",!0)])]))),128)):w("",!0),e("div",Rt,[e("div",null,[e("label",Mt,[y(e("input",{type:"checkbox",name:"no_additional_services_provided",id:"no_additional_services_provided",class:"RRclass no_additional_services_provided",formcontrolname:"checkbox",value:"true","onUpdate:modelValue":n[7]||(n[7]=t=>o.noAdditionalServicesProvided=t)},null,512),[[M,o.noAdditionalServicesProvided]]),Ut,At])])])]),o.additionalErrors?(_(),u("div",Tt,b(o.additionalErrorsMsg),1)):w("",!0)]),Wt])]),e("div",Vt,[e("div",Ft,[e("div",Lt,[e("div",Bt,[e("button",{type:"submit",class:"btn btn-primary m-1",id:"submit",disabled:o.timerStatus==1},"Submit",8,Pt)])])])])])],32)])])}const Ht=re(ye,[["render",Yt]]);export{Ht as default};
